version: '3.8'

services:
  api:
    image: python:3.9-slim
    command: >
      sh -c "pip install flask prometheus_client && \
             python -c 'from flask import Flask; from prometheus_client import start_http_server, Counter; import time; import random; \
             app = Flask(__name__); \
             requests = Counter(\"requests_total\", \"Total reqs\"); \
             @app.route(\"/\"); \
             def hello(): requests.inc(); time.sleep(random.random()/10); return \"Hello from Elite Portfolio!\" \
             if __name__ == \"__main__\": start_http_server(8000); app.run(host=\"0.0.0.0\", port=5000)'"
    ports:
      - "5000:5000"
      - "8000:8000"
    networks:
      - portfolio-net

  prometheus:
    image: prom/prometheus:latest
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
    ports:
      - "9090:9090"
    networks:
      - portfolio-net

  grafana:
    image: grafana/grafana:latest
    ports:
      - "3000:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin
    networks:
      - portfolio-net

networks:
  portfolio-net:
    driver: bridge
