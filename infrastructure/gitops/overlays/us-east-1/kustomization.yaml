apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - ../../base
namePrefix: use1-
patches:
  - target:
      kind: Deployment
      name: portfolio-api
    patch: |-
      - op: add
        path: /metadata/labels/topology.kubernetes.io~1region
        value: us-east-1
      - op: replace
        path: /spec/replicas
        value: 4
      - op: replace
        path: /spec/template/spec/containers/0/image
        value: ghcr.io/example/portfolio-api:stable
configMapGenerator:
  - behavior: merge
    name: platform-config
    literals:
      - PRIMARY_BUCKET=$(PRIMARY_BUCKET)
      - SECONDARY_BUCKET=$(SECONDARY_BUCKET)
