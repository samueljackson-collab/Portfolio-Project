{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "grafana"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "graphTooltip": 0,
  "id": null,
  "links": [],
  "panels": [
    {"collapsed": false, "gridPos": {"h": 1, "w": 24, "x": 0, "y": 0}, "id": 1, "panels": [], "title": "Row 1: Application Status", "type": "row"},
    {
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "red", "value": 0}]}, "mappings": []}, "overrides": []},
      "gridPos": {"h": 3, "w": 6, "x": 0, "y": 1},
      "id": 2,
      "options": {"colorMode": "background", "graphMode": "none", "justifyMode": "center", "orientation": "horizontal", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "value_and_name"},
      "targets": [{"expr": "probe_success{job=\"blackbox\", instance=\"https://wiki.homelab.local\"}", "refId": "A"}],
      "title": "Wiki.js Status",
      "type": "stat"
    },
    {
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "red", "value": 0}]}}, "overrides": []},
      "gridPos": {"h": 3, "w": 6, "x": 6, "y": 1},
      "id": 3,
      "options": {"colorMode": "background", "graphMode": "none", "justifyMode": "center", "orientation": "horizontal", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "value_and_name"},
      "targets": [{"expr": "probe_success{job=\"blackbox\", instance=\"https://homeassistant.homelab.local\"}", "refId": "A"}],
      "title": "Home Assistant Status",
      "type": "stat"
    },
    {
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "red", "value": 0}]}}, "overrides": []},
      "gridPos": {"h": 3, "w": 6, "x": 12, "y": 1},
      "id": 4,
      "options": {"colorMode": "background", "graphMode": "none", "justifyMode": "center", "orientation": "horizontal", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "value_and_name"},
      "targets": [{"expr": "probe_success{job=\"blackbox\", instance=\"https://immich.homelab.local\"}", "refId": "A"}],
      "title": "Immich Status",
      "type": "stat"
    },
    {
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 100}, {"color": "red", "value": 200}]}, "unit": "none"}},
      "gridPos": {"h": 3, "w": 6, "x": 18, "y": 1},
      "id": 5,
      "options": {"colorMode": "value", "graphMode": "none", "justifyMode": "center", "orientation": "horizontal", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "value_and_name"},
      "targets": [{"expr": "sum(app_active_sessions_total{service=~\"$service\"})", "refId": "A"}],
      "title": "Total Active Sessions",
      "type": "stat"
    },
    {"collapsed": false, "gridPos": {"h": 1, "w": 24, "x": 0, "y": 4}, "id": 6, "panels": [], "title": "Row 2: HTTP Metrics", "type": "row"},
    {
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "Req/s", "drawStyle": "line", "lineInterpolation": "smooth", "lineWidth": 2, "showPoints": "never"}}, "overrides": []},
      "gridPos": {"h": 7, "w": 8, "x": 0, "y": 5},
      "id": 7,
      "options": {"legend": {"calcs": ["lastNotNull", "mean", "max"], "displayMode": "table", "placement": "right"}, "tooltip": {"mode": "multi", "sort": "desc"}},
      "targets": [
        {"expr": "rate(nginx_http_requests_total{vhost=~\"wiki.homelab.local|homeassistant.homelab.local|immich.homelab.local\"}[5m])", "legendFormat": "{{vhost}}"}
      ],
      "title": "HTTP Request Rate",
      "type": "timeseries"
    },
    {
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "ms", "drawStyle": "line", "lineWidth": 2, "showPoints": "never"}, "unit": "ms"}},
      "gridPos": {"h": 7, "w": 8, "x": 8, "y": 5},
      "id": 8,
      "options": {"legend": {"calcs": ["lastNotNull"], "displayMode": "table", "placement": "right"}, "tooltip": {"mode": "multi", "sort": "desc"}},
      "targets": [
        {"expr": "histogram_quantile($quantile, rate(nginx_http_request_duration_seconds_bucket{vhost=~\"wiki.homelab.local|homeassistant.homelab.local|immich.homelab.local\"}[5m])) * 1000", "legendFormat": "{{vhost}} p$quantile"}
      ],
      "title": "HTTP Response Time",
      "type": "timeseries"
    },
    {
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "Errors/s", "drawStyle": "line", "lineWidth": 2, "showPoints": "never"}}},
      "gridPos": {"h": 7, "w": 8, "x": 16, "y": 5},
      "id": 9,
      "options": {"legend": {"calcs": ["lastNotNull", "mean"], "displayMode": "table", "placement": "right"}, "tooltip": {"mode": "multi", "sort": "desc"}},
      "targets": [
        {"expr": "rate(nginx_http_requests_total{status=~\"4..|5..\", vhost=~\"wiki.homelab.local|homeassistant.homelab.local|immich.homelab.local\"}[5m])", "legendFormat": "{{vhost}}"}
      ],
      "title": "HTTP Error Rate",
      "type": "timeseries"
    },
    {"collapsed": false, "gridPos": {"h": 1, "w": 24, "x": 0, "y": 12}, "id": 10, "panels": [], "title": "Row 3: Database Performance", "type": "row"},
    {
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "Connections", "drawStyle": "line", "lineWidth": 2}, "unit": "short"}},
      "gridPos": {"h": 7, "w": 8, "x": 0, "y": 13},
      "id": 11,
      "options": {"legend": {"calcs": ["lastNotNull"], "displayMode": "table", "placement": "right"}},
      "targets": [
        {"expr": "pg_stat_activity_count{datname=~\"wikijs|homeassistant|immich\", state=\"active\"}", "legendFormat": "{{datname}} active"},
        {"expr": "pg_stat_activity_count{datname=~\"wikijs|homeassistant|immich\", state=\"idle\"}", "legendFormat": "{{datname}} idle"}
      ],
      "title": "PostgreSQL Connections",
      "type": "timeseries"
    },
    {
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "ms", "drawStyle": "line", "lineWidth": 2}, "unit": "ms"}},
      "gridPos": {"h": 7, "w": 8, "x": 8, "y": 13},
      "id": 12,
      "options": {"legend": {"calcs": ["lastNotNull"], "displayMode": "table", "placement": "right"}},
      "targets": [
        {"expr": "avg(rate(pg_stat_statement_mean_time_seconds{datname=~\"wikijs|homeassistant|immich\"}[5m])) * 1000", "legendFormat": "{{datname}} avg"},
        {"expr": "histogram_quantile(0.95, rate(pg_stat_statement_duration_seconds_bucket{datname=~\"wikijs|homeassistant|immich\"}[5m])) * 1000", "legendFormat": "{{datname}} p95"}
      ],
      "title": "Query Execution Time",
      "type": "timeseries"
    },
    {
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "GB", "drawStyle": "line", "lineWidth": 2}, "unit": "decgbytes"}},
      "gridPos": {"h": 7, "w": 8, "x": 16, "y": 13},
      "id": 13,
      "options": {"legend": {"calcs": ["lastNotNull"], "displayMode": "table", "placement": "right"}},
      "targets": [
        {"expr": "pg_database_size_bytes{datname=~\"wikijs|homeassistant|immich\"} / 1024 / 1024 / 1024", "legendFormat": "{{datname}}"}
      ],
      "title": "Database Size Growth",
      "type": "timeseries"
    },
    {"collapsed": false, "gridPos": {"h": 1, "w": 24, "x": 0, "y": 20}, "id": 14, "panels": [], "title": "Row 4: Resource Usage", "type": "row"},
    {
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "CPU %", "drawStyle": "line", "lineWidth": 2}, "unit": "percent"}},
      "gridPos": {"h": 7, "w": 8, "x": 0, "y": 21},
      "id": 15,
      "options": {"legend": {"calcs": ["lastNotNull", "mean"], "displayMode": "table", "placement": "right"}},
      "targets": [
        {"expr": "100 - (avg by(pod) (irate(container_cpu_usage_seconds_total{namespace=\"apps\", pod=~\"wikijs|homeassistant|immich\"}[5m])) * 100)", "legendFormat": "{{pod}}"},
        {"expr": "avg by(vm) (proxmox_vm_cpu_usage_percent{vm=~\"Wiki.*|Home.*|Immich.*\"})", "legendFormat": "{{vm}}"}
      ],
      "title": "CPU Usage per Application",
      "type": "timeseries"
    },
    {
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "GB", "drawStyle": "line", "lineWidth": 2}, "unit": "decbytes"}},
      "gridPos": {"h": 7, "w": 8, "x": 8, "y": 21},
      "id": 16,
      "options": {"legend": {"calcs": ["lastNotNull"], "displayMode": "table", "placement": "right"}},
      "targets": [
        {"expr": "container_memory_usage_bytes{namespace=\"apps\", pod=~\"wikijs|homeassistant|immich\"}", "legendFormat": "{{pod}}"},
        {"expr": "proxmox_vm_mem_used_bytes{vm=~\"Wiki.*|Home.*|Immich.*\"}", "legendFormat": "{{vm}}"}
      ],
      "title": "Memory Usage per Application",
      "type": "timeseries"
    },
    {
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "IOPS", "drawStyle": "line", "lineWidth": 2}, "unit": "iops"}},
      "gridPos": {"h": 7, "w": 8, "x": 16, "y": 21},
      "id": 17,
      "options": {"legend": {"calcs": ["lastNotNull"], "displayMode": "table", "placement": "right"}},
      "targets": [
        {"expr": "rate(container_fs_reads_total{namespace=\"apps\", pod=~\"wikijs|homeassistant|immich\"}[5m])", "legendFormat": "{{pod}} read"},
        {"expr": "rate(container_fs_writes_total{namespace=\"apps\", pod=~\"wikijs|homeassistant|immich\"}[5m])", "legendFormat": "{{pod}} write"}
      ],
      "title": "Disk I/O per Application",
      "type": "timeseries"
    },
    {"collapsed": false, "gridPos": {"h": 1, "w": 24, "x": 0, "y": 28}, "id": 18, "panels": [], "title": "Row 5: User Activity", "type": "row"},
    {
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "Count", "drawStyle": "line", "lineWidth": 2}}},
      "gridPos": {"h": 7, "w": 8, "x": 0, "y": 29},
      "id": 19,
      "options": {"legend": {"calcs": ["lastNotNull", "sum"], "displayMode": "table", "placement": "right"}},
      "targets": [
        {"expr": "rate(wikijs_page_views_total[5m])", "legendFormat": "Views"},
        {"expr": "rate(wikijs_page_edits_total[5m])", "legendFormat": "Edits"}
      ],
      "title": "Wiki.js Activity",
      "type": "timeseries"
    },
    {
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "Events", "drawStyle": "line", "lineWidth": 2}}},
      "gridPos": {"h": 7, "w": 8, "x": 8, "y": 29},
      "id": 20,
      "options": {"legend": {"calcs": ["lastNotNull", "sum"], "displayMode": "table", "placement": "right"}},
      "targets": [
        {"expr": "rate(homeassistant_entity_state_changes_total[5m])", "legendFormat": "Entity Changes"},
        {"expr": "rate(homeassistant_automation_runs_total[5m])", "legendFormat": "Automation Runs"}
      ],
      "title": "Home Assistant Activity",
      "type": "timeseries"
    },
    {
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "Count", "drawStyle": "line", "lineWidth": 2}}},
      "gridPos": {"h": 7, "w": 8, "x": 16, "y": 29},
      "id": 21,
      "options": {"legend": {"calcs": ["lastNotNull", "sum"], "displayMode": "table", "placement": "right"}},
      "targets": [
        {"expr": "rate(immich_photos_uploaded_total[5m])", "legendFormat": "Uploads"},
        {"expr": "immich_library_storage_used_bytes / 1024 / 1024 / 1024", "legendFormat": "Storage Used (GB)"}
      ],
      "title": "Immich Activity",
      "type": "timeseries"
    }
  ],
  "refresh": "1m",
  "schemaVersion": 36,
  "style": "dark",
  "tags": ["homelab", "applications"],
  "templating": {
    "list": [
      {
        "current": {"selected": true, "text": "All", "value": "All"},
        "datasource": {"type": "prometheus", "uid": "prometheus"},
        "definition": "label_values(nginx_http_requests_total, vhost)",
        "hide": 0,
        "includeAll": true,
        "label": "Service",
        "multi": true,
        "name": "service",
        "options": [],
        "query": "label_values(nginx_http_requests_total, vhost)",
        "refresh": 1,
        "regex": "wiki|homeassistant|immich",
        "sort": 1,
        "type": "query"
      },
      {
        "current": {"selected": true, "text": "0.95", "value": "0.95"},
        "hide": 0,
        "label": "Quantile",
        "name": "quantile",
        "options": [
          {"selected": false, "text": "0.5", "value": "0.5"},
          {"selected": false, "text": "0.9", "value": "0.9"},
          {"selected": true, "text": "0.95", "value": "0.95"},
          {"selected": false, "text": "0.99", "value": "0.99"}
        ],
        "query": "0.95",
        "refresh": 2,
        "type": "interval"
      }
    ]
  },
  "time": {"from": "now-24h", "to": "now"},
  "timepicker": {"refresh_intervals": ["30s", "1m", "5m", "15m", "30m", "1h"], "time_options": ["1h", "6h", "12h", "24h", "7d"]},
  "timezone": "",
  "title": "Application Metrics - Homelab Services",
  "uid": "homelab-apps-overview",
  "version": 1
}
