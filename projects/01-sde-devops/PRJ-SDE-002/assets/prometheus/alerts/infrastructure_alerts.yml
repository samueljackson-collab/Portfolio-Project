groups:
  - name: infrastructure_alerts
    rules:
      # Backup failures
      - alert: BackupFailed
        expr: increase(backup_last_status{status="failed"}[1h]) > 0
        for: 5m
        labels:
          severity: critical
          category: infrastructure
        annotations:
          summary: "Backup failed on {{ $labels.instance }}"
          description: "Backup job {{ $labels.job }} has failed on {{ $labels.instance }}"

      # Container restarts
      - alert: ContainerRestarting
        expr: rate(container_restart_count[15m]) > 0
        for: 5m
        labels:
          severity: warning
          category: infrastructure
        annotations:
          summary: "Container {{ $labels.name }} restarting frequently"
          description: "Container {{ $labels.name }} on {{ $labels.instance }} has restarted {{ $value }} times in the last 15 minutes"

      # Network errors
      - alert: HighNetworkErrors
        expr: rate(node_network_receive_errs_total[5m]) > 10
        for: 5m
        labels:
          severity: warning
          category: infrastructure
        annotations:
          summary: "High network errors on {{ $labels.instance }}"
          description: "Network interface {{ $labels.device }} on {{ $labels.instance }} experiencing high error rate: {{ $value }} errors/sec"

      # ZFS pool health
      - alert: ZFSPoolDegraded
        expr: node_zfs_zpool_state{state!="online"} > 0
        for: 5m
        labels:
          severity: critical
          category: infrastructure
        annotations:
          summary: "ZFS pool {{ $labels.zpool }} degraded on {{ $labels.instance }}"
          description: "ZFS pool {{ $labels.zpool }} is in {{ $labels.state }} state"
