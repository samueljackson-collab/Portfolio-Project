# Alertmanager Configuration - Sanitized Example for PRJ-SDE-002
# Replace environment variables before deployment.

global:
  resolve_timeout: 5m
  smtp_smarthost: 'smtp.example.internal:587'
  smtp_from: 'alerts@example.internal'
  smtp_auth_username: '${ALERTMANAGER_SMTP_USERNAME}'
  smtp_auth_password: '${ALERTMANAGER_SMTP_PASSWORD}'
  smtp_require_tls: true
  slack_api_url: '${ALERTMANAGER_SLACK_WEBHOOK_URL}'

route:
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 15s
  group_interval: 10s
  repeat_interval: 6h
  receiver: 'critical-all'
  routes:
    - matchers: ['severity="critical"']
      receiver: 'critical-all'
    - matchers: ['severity="warning"']
      receiver: 'warning-slack'
    - matchers: ['category="backup"']
      receiver: 'backup-team'

receivers:
  - name: 'critical-all'
    email_configs:
      - to: 'oncall@example.internal'
        headers:
          Subject: 'üö® CRITICAL: {{ .GroupLabels.alertname }} - {{ .GroupLabels.instance }}'
        html: |-
          <h3>Critical Alert</h3>
          <p><strong>Alert:</strong> {{ .GroupLabels.alertname }}</p>
          <p><strong>Instance:</strong> {{ .GroupLabels.instance }}</p>
          <p><strong>Description:</strong> {{ range .Alerts }}{{ .Annotations.description }}{{ end }}</p>
          <p><strong>Runbook:</strong> {{ range .Alerts }}{{ .Annotations.runbook_url }}{{ end }}</p>
    slack_configs:
      - channel: '#portfolio-alerts'
        title: 'üö® Critical Alert'
        text: |-
          *Alert:* {{ .GroupLabels.alertname }}\n*Instance:* {{ .GroupLabels.instance }}\n*Runbook:* {{ range .Alerts }}{{ .Annotations.runbook_url }}{{ end }}
        color: 'danger'

  - name: 'warning-slack'
    slack_configs:
      - channel: '#portfolio-monitoring'
        title: '‚ö†Ô∏è Warning Alert'
        text: |-
          *Alert:* {{ .GroupLabels.alertname }}\n*Instance:* {{ .GroupLabels.instance }}\n*Details:* {{ range .Alerts }}{{ .Annotations.description }}{{ end }}
        color: 'warning'

  - name: 'backup-team'
    email_configs:
      - to: 'backup-team@example.internal'
        headers:
          Subject: 'üíæ Backup Alert: {{ .GroupLabels.alertname }}'
        html: |-
          <p>Backup-related alert firing.</p>
          <p>{{ range .Alerts }}{{ .Annotations.description }}{{ end }}</p>

inhibit_rules:
  - source_matchers: ['severity="critical"']
    target_matchers: ['severity="warning"']
    equal: ['alertname', 'instance']
  - source_matchers: ['alertname="HostDown"']
    target_matchers: ['alertname=~"HighCPUUsage|HighMemoryUsage|DiskSpaceWarning"']
    equal: ['instance']

# Sanitized placeholders only; configure real URLs and secrets via environment variables.
