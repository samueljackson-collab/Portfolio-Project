# Example Terraform Variables for SIEM Pipeline
# Copy this file to terraform.tfvars and customize for your deployment
# Command: cp terraform.tfvars.example terraform.tfvars

#------------------------------------------------------------------------------
# General Configuration
#------------------------------------------------------------------------------

project_name = "siem"
environment  = "dev"  # Options: dev, staging, prod
aws_region   = "us-east-1"

#------------------------------------------------------------------------------
# Network Configuration
#------------------------------------------------------------------------------

# Option 1: Use existing VPC (recommended)
create_vpc      = false
use_default_vpc = false
vpc_id          = "vpc-xxxxx"  # Replace with your VPC ID
subnet_ids      = [             # Private subnets across AZs
  "subnet-xxxxx",  # AZ 1
  "subnet-yyyyy",  # AZ 2
  "subnet-zzzzz"   # AZ 3
]

# Option 2: Use default VPC
# create_vpc      = false
# use_default_vpc = true

#------------------------------------------------------------------------------
# OpenSearch Configuration
#------------------------------------------------------------------------------

# Cluster settings
opensearch_engine_version  = "OpenSearch_2.11"
opensearch_instance_type   = "t3.small.search"  # Options: t3.small, t3.medium, m6g.large
opensearch_instance_count  = 3  # Must match AZ count for HA

# High availability
opensearch_zone_awareness = true
opensearch_az_count       = 3  # Options: 2 or 3

# Dedicated master nodes (optional, for production)
opensearch_dedicated_master = false
opensearch_master_type      = "t3.small.search"
opensearch_master_count     = 3

# Storage
opensearch_ebs_type = "gp3"  # Options: gp2, gp3, io1
opensearch_ebs_size = 20     # GB per node

# Security (IMPORTANT: Change these!)
opensearch_master_user     = "admin"
opensearch_master_password = "CHANGE-ME-STRONG-PASSWORD-MIN-8-CHARS"  # CRITICAL!

# Index configuration
opensearch_index_name = "security-events"

#------------------------------------------------------------------------------
# Log Sources
#------------------------------------------------------------------------------

# Enable AWS security services
enable_guardduty  = true   # Threat detection
enable_cloudtrail = true   # API audit logging

# Add VPC Flow Logs by configuring in modules/kinesis-firehose

#------------------------------------------------------------------------------
# Lambda Configuration
#------------------------------------------------------------------------------

# Path to Lambda deployment package
# Run: cd ../lambda && ./package.sh
lambda_zip_path = "../lambda/log_transformer.zip"

#------------------------------------------------------------------------------
# Kinesis Firehose Configuration
#------------------------------------------------------------------------------

# Buffering settings (balance between latency and cost)
firehose_buffer_size     = 5    # MB (1-100)
firehose_buffer_interval = 300  # seconds (60-900)
# Logs flush when EITHER buffer size OR interval is reached

#------------------------------------------------------------------------------
# Alerting Configuration
#------------------------------------------------------------------------------

# Email for security alerts
alert_email = "security-team@example.com"  # CHANGE ME!

# Optional: KMS key for SNS encryption
# sns_kms_key_id = "arn:aws:kms:us-east-1:123456789012:key/xxxxx"

#------------------------------------------------------------------------------
# Monitoring Configuration
#------------------------------------------------------------------------------

# CloudWatch log retention
log_retention_days = 7  # Options: 1, 3, 5, 7, 14, 30, 60, 90, etc.

#------------------------------------------------------------------------------
# Example Configurations by Environment
#------------------------------------------------------------------------------

# Development Environment (cost-optimized):
# ---------------------------------------------
# environment                = "dev"
# opensearch_instance_type   = "t3.small.search"
# opensearch_instance_count  = 1
# opensearch_zone_awareness  = false
# opensearch_az_count        = 1
# opensearch_dedicated_master = false
# enable_guardduty           = true
# enable_cloudtrail          = false  # Optional for dev
# log_retention_days         = 3
# Monthly Cost: ~$30-50

# Staging Environment (balanced):
# ---------------------------------------------
# environment                = "staging"
# opensearch_instance_type   = "t3.small.search"
# opensearch_instance_count  = 2
# opensearch_zone_awareness  = true
# opensearch_az_count        = 2
# opensearch_dedicated_master = false
# enable_guardduty           = true
# enable_cloudtrail          = true
# log_retention_days         = 7
# Monthly Cost: ~$70-120

# Production Environment (high availability):
# ---------------------------------------------
# environment                = "prod"
# opensearch_instance_type   = "t3.medium.search"  # or m6g.large.search
# opensearch_instance_count  = 3
# opensearch_zone_awareness  = true
# opensearch_az_count        = 3
# opensearch_dedicated_master = true
# opensearch_master_type     = "t3.small.search"
# opensearch_master_count    = 3
# opensearch_ebs_type        = "gp3"
# opensearch_ebs_size        = 50
# enable_guardduty           = true
# enable_cloudtrail          = true
# log_retention_days         = 30
# Monthly Cost: ~$200-400

#------------------------------------------------------------------------------
# Important Notes
#------------------------------------------------------------------------------

# 1. NEVER commit terraform.tfvars to version control (in .gitignore)
# 2. Store opensearch_master_password in AWS Secrets Manager for production
# 3. Use private subnets for OpenSearch deployment
# 4. Enable GuardDuty and CloudTrail for comprehensive monitoring
# 5. Configure SNS email subscription and confirm the subscription
# 6. Review CloudWatch alarms after deployment
# 7. Test with sample security events before production use
# 8. Plan for ~60 seconds latency from log generation to OpenSearch
# 9. Monitor Kinesis Firehose throttling if high volume
# 10. Set up automated OpenSearch snapshots for backup

#------------------------------------------------------------------------------
# Cost Estimation
#------------------------------------------------------------------------------

# Development (1 node, t3.small.search, 20GB):
#   OpenSearch: ~$25/month
#   Kinesis Firehose: ~$5-10/month (based on data volume)
#   Lambda: ~$1-5/month
#   CloudWatch Logs: ~$5-10/month
#   S3 Storage: ~$1-2/month
#   Total: ~$40-55/month

# Production (3 nodes + 3 masters, multi-AZ, 50GB per node):
#   OpenSearch: ~$150-250/month
#   Kinesis Firehose: ~$20-40/month
#   Lambda: ~$5-10/month
#   CloudWatch Logs: ~$20-30/month
#   S3 Storage: ~$5-10/month
#   GuardDuty: ~$5-20/month (usage-based)
#   CloudTrail: ~$2-10/month (usage-based)
#   Total: ~$200-370/month

# Actual costs vary based on:
# - Log volume (GB ingested per day)
# - Number of GuardDuty findings
# - CloudTrail event volume
# - Data retention period
# - Instance types and sizes
