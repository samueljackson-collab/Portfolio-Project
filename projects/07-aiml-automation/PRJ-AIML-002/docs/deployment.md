# Deployment Guide

Complete guide for deploying the Tab Organizer application across all platforms.

## Table of Contents
1. [Prerequisites](#prerequisites)
2. [Flutter App Deployment](#flutter-app-deployment)
3. [Browser Extension Deployment](#browser-extension-deployment)
4. [Firebase Setup](#firebase-setup)
5. [Native Messaging Host](#native-messaging-host)
6. [AI Model Deployment](#ai-model-deployment)
7. [Testing](#testing)
8. [Troubleshooting](#troubleshooting)

## Prerequisites

### Required Tools
```bash
# Flutter SDK (3.x or later)
flutter --version

# Dart SDK (included with Flutter)
dart --version

# Node.js (16.x or later) for native host
node --version
npm --version

# Python (3.8+) for ML model training
python --version

# Git
git --version
```

### Development Environment
- **Windows**: Windows 10 or later
- **macOS**: macOS 10.14 or later
- **Android**: Android SDK 21+ (Android 5.0+)
- **Linux**: Ubuntu 20.04 or later

## Flutter App Deployment

### 1. Setup Project

```bash
# Navigate to Flutter app directory
cd code-examples/flutter-app

# Install dependencies
flutter pub get

# Generate code (models, Hive adapters)
dart run build_runner build --delete-conflicting-outputs
```

### 2. Configure Firebase

Create `lib/firebase_options.dart`:
```dart
// This file is generated by FlutterFire CLI
// Run: flutterfire configure

class DefaultFirebaseOptions {
  static FirebaseOptions get currentPlatform {
    // Platform-specific Firebase configuration
  }
}
```

### 3. Build for Desktop

#### Windows
```bash
flutter build windows --release

# Output: build/windows/runner/Release/
```

#### macOS
```bash
flutter build macos --release

# Output: build/macos/Build/Products/Release/
```

#### Linux
```bash
flutter build linux --release

# Output: build/linux/x64/release/bundle/
```

### 4. Build for Mobile

#### Android
```bash
# Build APK
flutter build apk --release

# Build App Bundle (for Play Store)
flutter build appbundle --release

# Output: build/app/outputs/
```

#### iOS
```bash
# Requires macOS and Xcode
flutter build ios --release

# Create archive for App Store
flutter build ipa

# Output: build/ios/archive/
```

### 5. Package Application

#### Windows Installer
```bash
# Using Inno Setup or MSIX
# Create installer package
# Include native messaging host manifest
```

#### macOS Package
```bash
# Create .dmg or .pkg
# Code sign the application
codesign --force --deep --sign "Developer ID" TabOrganizer.app

# Notarize for Gatekeeper
xcrun notarytool submit TabOrganizer.dmg
```

#### Linux Package
```bash
# Create .deb package
dpkg-deb --build tab-organizer

# Create .rpm package
rpmbuild -ba tab-organizer.spec
```

## Browser Extension Deployment

### Chrome Extension

#### 1. Prepare Package
```bash
cd code-examples/browser-extensions/chrome-extension

# Create ZIP file
zip -r tab-organizer-chrome.zip * -x "*.git*"
```

#### 2. Chrome Web Store Deployment

1. Go to [Chrome Web Store Developer Dashboard](https://chrome.google.com/webstore/devconsole/)
2. Click "New Item"
3. Upload `tab-organizer-chrome.zip`
4. Fill in listing information:
   - Title: Tab Organizer
   - Summary: AI-powered tab organization
   - Description: Full description with features
   - Category: Productivity
   - Screenshots: 1280x800 or 640x400
   - Icons: 128x128 (required)
5. Set pricing (free)
6. Submit for review

#### 3. Developer Mode Installation (Testing)
```bash
1. Open Chrome
2. Go to chrome://extensions
3. Enable "Developer mode"
4. Click "Load unpacked"
5. Select chrome-extension directory
```

### Firefox Extension

#### 1. Prepare Package
```bash
cd code-examples/browser-extensions/firefox-extension

# Create XPI file
zip -r tab-organizer-firefox.xpi * -x "*.git*"
```

#### 2. Firefox Add-ons Deployment

1. Go to [Firefox Add-on Developer Hub](https://addons.mozilla.org/developers/)
2. Click "Submit New Add-on"
3. Upload `tab-organizer-firefox.xpi`
4. Fill in listing information
5. Select appropriate categories
6. Submit for review

#### 3. Developer Mode Installation (Testing)
```bash
1. Open Firefox
2. Go to about:debugging#/runtime/this-firefox
3. Click "Load Temporary Add-on"
4. Select manifest.json from firefox-extension directory
```

### Edge Extension

Edge uses the same extension as Chrome (Chromium-based).

#### Deployment
1. Go to [Edge Add-ons Developer Dashboard](https://partner.microsoft.com/dashboard/microsoftedge)
2. Upload Chrome extension package
3. Follow similar process as Chrome Web Store

## Firebase Setup

### 1. Create Firebase Project

```bash
# Install Firebase CLI
npm install -g firebase-tools

# Login to Firebase
firebase login

# Initialize Firebase in Flutter project
cd code-examples/flutter-app
firebase init

# Select services:
# - Firestore
# - Authentication
# - Functions (optional)
```

### 2. Configure Firestore

Create security rules:
```javascript
// firestore.rules
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /users/{userId} {
      allow read, write: if request.auth.uid == userId;

      match /tabs/{tabId} {
        allow read, write: if request.auth.uid == userId;
      }

      match /groups/{groupId} {
        allow read, write: if request.auth.uid == userId;
      }

      match /metadata/{document} {
        allow read, write: if request.auth.uid == userId;
      }
    }
  }
}
```

Deploy rules:
```bash
firebase deploy --only firestore:rules
```

### 3. Configure Authentication

Enable auth methods in Firebase Console:
- Anonymous (default)
- Email/Password (optional)
- Google (optional)

### 4. Configure Flutter App

```bash
# Install FlutterFire CLI
dart pub global activate flutterfire_cli

# Configure Firebase
flutterfire configure
```

## Native Messaging Host

### 1. Create Host Executable

#### Option A: Dart
```dart
// native_host.dart
import 'dart:io';
import 'dart:convert';

void main() {
  stdin
      .transform(utf8.decoder)
      .transform(json.decoder)
      .listen(handleMessage);
}

void handleMessage(dynamic message) {
  // Handle message from extension
  // Send response
  stdout.writeln(json.encode(response));
}
```

Compile:
```bash
dart compile exe native_host.dart -o native_host
```

#### Option B: Node.js
```javascript
// native_host.js
const readline = require('readline');

const rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout,
  terminal: false
});

rl.on('line', (line) => {
  const message = JSON.parse(line);
  handleMessage(message);
});

function handleMessage(message) {
  // Handle message
  console.log(JSON.stringify(response));
}
```

### 2. Install Native Host

#### Windows
```bash
# Copy host executable
copy native_host.exe "%LOCALAPPDATA%\TabOrganizer\"

# Register with Chrome
reg add "HKCU\Software\Google\Chrome\NativeMessagingHosts\com.taborganizer.native" /ve /t REG_SZ /d "%LOCALAPPDATA%\TabOrganizer\manifest.json" /f
```

Create manifest:
```json
{
  "name": "com.taborganizer.native",
  "description": "Tab Organizer Native Messaging Host",
  "path": "C:\\Users\\{username}\\AppData\\Local\\TabOrganizer\\native_host.exe",
  "type": "stdio",
  "allowed_origins": [
    "chrome-extension://[EXTENSION_ID]/"
  ]
}
```

#### macOS
```bash
# Copy host executable
cp native_host /usr/local/bin/tab-organizer-host

# Create manifest directory
mkdir -p ~/Library/Application\ Support/Google/Chrome/NativeMessagingHosts/

# Copy manifest
cp com.taborganizer.native.json ~/Library/Application\ Support/Google/Chrome/NativeMessagingHosts/
```

#### Linux
```bash
# Copy host executable
sudo cp native_host /usr/local/bin/tab-organizer-host

# Create manifest directory
mkdir -p ~/.config/google-chrome/NativeMessagingHosts/

# Copy manifest
cp com.taborganizer.native.json ~/.config/google-chrome/NativeMessagingHosts/
```

## AI Model Deployment

### 1. Train Model

```bash
cd code-examples/ai-model

# Install dependencies
pip install tensorflow scikit-learn numpy

# Train model
python train_model.py

# Output: tab_classifier.tflite
```

### 2. Deploy Model

Copy model to Flutter assets:
```bash
cp tab_classifier.tflite ../flutter-app/assets/models/

# Update pubspec.yaml
# assets:
#   - assets/models/tab_classifier.tflite
```

### 3. Verify Model

```dart
// Test model loading
final interpreter = await Interpreter.fromAsset('assets/models/tab_classifier.tflite');
print('Model loaded: ${interpreter != null}');
```

## Testing

### Unit Tests
```bash
cd code-examples/flutter-app

# Run unit tests
flutter test

# Run with coverage
flutter test --coverage
```

### Integration Tests
```bash
# Run integration tests
flutter test integration_test/

# Run on device
flutter drive --target=integration_test/app_test.dart
```

### Browser Extension Tests
```bash
cd code-examples/browser-extensions/chrome-extension

# Install test dependencies
npm install --save-dev jest

# Run tests
npm test
```

## Distribution

### Google Play Store (Android)
1. Create developer account ($25 one-time fee)
2. Upload App Bundle (.aab file)
3. Fill in store listing
4. Set content rating
5. Submit for review

### Apple App Store (iOS)
1. Enroll in Apple Developer Program ($99/year)
2. Create app in App Store Connect
3. Upload .ipa file using Transporter
4. Fill in app information
5. Submit for review

### Microsoft Store (Windows)
1. Create Microsoft Partner Center account
2. Create app submission
3. Upload MSIX package
4. Fill in store listing
5. Submit for certification

### Mac App Store (macOS)
1. Use Apple Developer account
2. Create app in App Store Connect
3. Code sign and notarize app
4. Upload .pkg file
5. Submit for review

## Monitoring

### Setup Analytics
```dart
// Add Firebase Analytics
import 'package:firebase_analytics/firebase_analytics.dart';

final analytics = FirebaseAnalytics.instance;
await analytics.logEvent(name: 'tab_created');
```

### Setup Crash Reporting
```dart
// Add Firebase Crashlytics
import 'package:firebase_crashlytics/firebase_crashlytics.dart';

FlutterError.onError = FirebaseCrashlytics.instance.recordFlutterFatalError;
```

## Troubleshooting

### Common Issues

#### Extension Not Connecting
- Check native messaging host path
- Verify extension ID in manifest
- Check Chrome/Firefox console for errors
- Ensure host executable has execute permissions

#### Firebase Connection Failed
- Verify Firebase configuration
- Check internet connection
- Ensure Firestore rules are correct
- Check API keys and project ID

#### ML Model Not Loading
- Verify model file exists in assets
- Check model file size (<10MB recommended)
- Ensure TFLite dependencies are installed
- Test model with sample data

#### Hive Database Errors
- Delete local database and restart
- Check write permissions
- Verify Hive adapters are generated
- Ensure TypeAdapters are registered

### Debug Commands

```bash
# Flutter logs
flutter logs

# Chrome extension logs
chrome://extensions → Tab Organizer → Inspect views: background page

# Firebase debug
firebase emulators:start

# Native host debug
# Add logging to native_host executable
```

## Updates and Maintenance

### App Updates
1. Increment version in pubspec.yaml
2. Update CHANGELOG.md
3. Build new release
4. Submit to stores

### Extension Updates
1. Increment version in manifest.json
2. Create new ZIP/XPI package
3. Upload to extension stores
4. Users auto-update within 24-48 hours

### Model Updates
1. Retrain model with new data
2. Test model accuracy
3. Deploy new .tflite file
4. Push app update

## Security Checklist

- [ ] Code obfuscation enabled (`--obfuscate`)
- [ ] API keys secured (not in source code)
- [ ] HTTPS only for network requests
- [ ] Input validation on all user data
- [ ] Firestore security rules implemented
- [ ] Native messaging host permissions restricted
- [ ] Extension permissions minimized
- [ ] Data encryption at rest
- [ ] Privacy policy published
- [ ] GDPR compliance (if applicable)

## Post-Deployment

### Monitor Metrics
- Daily active users
- Tab organization usage
- Sync success rate
- Error rates
- User feedback/reviews

### Gather Feedback
- In-app feedback form
- Store reviews
- GitHub issues
- User surveys

### Iterate
- Analyze user behavior
- Improve ML model
- Add requested features
- Fix reported bugs

---

**Last Updated**: 2025-11-10
**Version**: 1.0.0
**Contact**: [GitHub](https://github.com/samueljackson-collab)
