# Internal Network Pentest Lab

## Documentation
For cross-project documentation, standards, and runbooks, see the [Portfolio Documentation Hub](../../DOCUMENTATION_INDEX.md).


A small lab for rehearsing internal network penetration tests. The FastAPI backend models hosts, findings, and attack paths with JWT-protected CRUD. The React frontend visualizes lateral movement across the modeled estate.

## Scenario walkthrough
1. The purple team exposes a handful of Linux and Windows hosts discovered during subnet scanning.
2. Findings (SQL injection, weak RDP creds, SMB signing disabled) are logged against each host.
3. Attack paths string hosts together to illustrate pivot chains, driving remediation priorities.
4. The lateral movement helper highlights reachable hosts from each step to speed tabletop exercises.

## Project layout
- `backend/` – FastAPI service with JWT auth, validation, and helpers.
- `frontend/` – React dashboard for host/finding entry and attack-path visualization.
- `terraform/` – Opinionated AWS footprint (VPC, RDS Postgres, ECS on EC2, jump box).
- `docker-compose.yml` – Local stack for backend + frontend.

## Setup
### Backend
```bash
cd backend
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
uvicorn app.main:app --reload
```
- Get a token via `POST /auth/token` with `{"username": "operator", "password": "changeme"}`.
- Health probe: `GET /health`.

### Frontend
```bash
cd frontend
npm install
npm run dev -- --host --port 4173
```
Set `VITE_API_BASE` if the API is not on `http://localhost:8000`.

### Docker Compose
```bash
cd projects/internal-net-pentest
docker compose up --build
```
Frontend will be available on `http://localhost:4173` and proxies API calls to the FastAPI container.

## Usage flow
1. Authenticate and obtain a JWT in the UI.
2. Add hosts (hostname, IP, OS, criticality).
3. Log findings against host IDs; invalid host IDs return `400` to prevent orphaned records.
4. Build attack paths by selecting source/target hosts and a technique. Invalid host references are rejected.
5. Open the visualization panel to see path details and reachable hosts calculated by the lateral-movement helper.

## Database + migrations
The demo API stores data in memory for speed. When wiring to Postgres (e.g., RDS), initialize schema with your ORM migrations (Alembic/SQLModel) and point `DATABASE_URL` accordingly. The Terraform module provisions an RDS instance for this purpose.

## Security notes
- JWT secrets and database credentials should come from secrets managers, not source control.
- Limit CORS origins for production deployments.
- Run the provided PyTest suite for negative-path checks (bad host IDs) and basic behavior.
- Harden the jump box and restrict security groups when using the Terraform module.

## Tests
- Backend: `pytest` from the `backend` directory.
- Frontend: `npm test` from the `frontend` directory (Vitest + Testing Library).
