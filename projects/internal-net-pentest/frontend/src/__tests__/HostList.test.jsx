import { fireEvent, render, screen } from '@testing-library/react';
import { vi } from 'vitest';
import '@testing-library/jest-dom';
import HostList from '../components/HostList';

test('renders empty state and submits new host', async () => {
  const onCreate = vi.fn();
  render(<HostList hosts={[]} onCreate={onCreate} />);

  expect(screen.getByText(/No hosts modeled yet/i)).toBeInTheDocument();

  fireEvent.change(screen.getByPlaceholderText(/hostname/i), { target: { value: 'app-01' } });
  fireEvent.change(screen.getByPlaceholderText(/10.0.0.10/i), { target: { value: '10.0.0.10' } });
  fireEvent.change(screen.getByPlaceholderText(/OS/i), { target: { value: 'Ubuntu' } });
  fireEvent.submit(screen.getByRole('button', { name: /add host/i }));

  expect(onCreate).toHaveBeenCalledWith({
    hostname: 'app-01',
    ip_address: '10.0.0.10',
    operating_system: 'Ubuntu',
    criticality: 'medium',
  });
});
