# Homelab Environment Variables Template
# ========================================
# This file contains all secrets and sensitive configuration
# for Docker Compose services in the homelab environment.
#
#   CRITICAL SECURITY WARNINGS  
# ================================
# 1. NEVER commit this file to version control (.gitignore it)
# 2. NEVER share these credentials publicly or in screenshots
# 3. Store backup copy in encrypted password manager (1Password, Bitwarden)
# 4. Rotate credentials quarterly (March, June, September, December)
# 5. Use unique passwords for each service (never reuse across services)
# 6. Minimum password strength: 32 characters, mixed case, numbers, symbols
#
# Password Generation Commands:
# ==============================
# Strong password (32 chars): openssl rand -base64 32
# Hex string (64 chars):      openssl rand -hex 32
# Alphanumeric (40 chars):    pwgen -s 40 1
#
# Usage:
# ======
# 1. Copy this template:     cp example.env .env
# 2. Edit with your values:  nano .env
# 3. Restrict permissions:   chmod 600 .env
# 4. Verify not in git:      git status (should not show .env)
#
# Last Updated: November 6, 2025
# ========================================

# ========================================
# GLOBAL SETTINGS
# ========================================

# Timezone (used by all containers)
# Find yours: https://en.wikipedia.org/wiki/List_of_tz_database_time_zones
TZ=America/Los_Angeles

# Email for notifications and admin accounts
ADMIN_EMAIL=admin@homelab.local

# ========================================
# POSTGRESQL DATABASE
# ========================================
# Centralized database server (VM ID: 103, IP: 192.168.40.23)

# PostgreSQL superuser password (postgres user)
# Used for: Database administration, creating new databases/users
# Rotation: Every 3 months
# Last rotated: 2025-11-01
# Generate: openssl rand -base64 32
POSTGRES_SUPERUSER_PASSWORD=REPLACE_WITH_STRONG_PASSWORD_32_CHARS

# Future use: Streaming replication password (for HA setup)
POSTGRES_REPLICATION_PASSWORD=REPLACE_WITH_STRONG_PASSWORD_32_CHARS

# ========================================
# WIKI.JS (VM ID: 100, IP: 192.168.40.20)
# ========================================

# PostgreSQL database password for wikijs user
# Used for: Wiki.js database connection
# Database: wikijs on 192.168.40.23:5432
# Rotation: Every 3 months
# Last rotated: 2025-11-01
# Generate: openssl rand -base64 32
WIKIJS_DB_PASSWORD=REPLACE_WITH_STRONG_PASSWORD_32_CHARS

# Session secret for cookie signing
# Used for: Signing JWT tokens and session cookies
# CRITICAL: If changed, all users will be logged out
# Rotation: Every 6 months (disruptive to change)
# Last rotated: 2025-11-01
# Generate: openssl rand -hex 32
WIKIJS_SESSION_SECRET=REPLACE_WITH_RANDOM_HEX_64_CHARS

# Admin email for Wiki.js
WIKIJS_ADMIN_EMAIL=${ADMIN_EMAIL}

# ========================================
# HOME ASSISTANT (VM ID: 101, IP: 192.168.40.21)
# ========================================

# PostgreSQL database password for homeassistant user
# Used for: Home Assistant recorder (historical data)
# Database: homeassistant on 192.168.40.23:5432
# Rotation: Every 3 months
# Last rotated: 2025-10-15
# Generate: openssl rand -base64 32
HOMEASSISTANT_DB_PASSWORD=REPLACE_WITH_STRONG_PASSWORD_32_CHARS

# MQTT broker credentials (Mosquitto)
# Used for: IoT device communication (Zigbee, WiFi devices)
# Rotation: Every 3 months (requires updating all MQTT clients)
# Last rotated: 2025-10-15
# Generate: openssl rand -base64 32
MQTT_USERNAME=homeassistant
MQTT_PASSWORD=REPLACE_WITH_STRONG_PASSWORD_32_CHARS

# ========================================
# IMMICH (VM ID: 102, IP: 192.168.40.22)
# ========================================

# PostgreSQL database password for immich user
# Used for: Immich photo metadata and ML data
# Database: immich on 192.168.40.23:5432
# Rotation: Every 3 months
# Last rotated: 2025-10-15
# Generate: openssl rand -base64 32
IMMICH_DB_PASSWORD=REPLACE_WITH_STRONG_PASSWORD_32_CHARS

# Redis password (for job queue and caching)
# Used for: Background job processing (ML, thumbnails, video transcoding)
# Rotation: Every 3 months
# Last rotated: 2025-10-15
# Generate: openssl rand -base64 32
IMMICH_REDIS_PASSWORD=REPLACE_WITH_STRONG_PASSWORD_32_CHARS

# Typesense API key (search engine)
# Used for: Photo search and metadata indexing
# Rotation: Every 6 months
# Last rotated: 2025-09-01
# Generate: openssl rand -base64 32
IMMICH_TYPESENSE_API_KEY=REPLACE_WITH_RANDOM_KEY_32_CHARS

# ========================================
# NGINX PROXY MANAGER (VM ID: 105, IP: 192.168.40.25)
# ========================================

# Admin UI credentials
# Used for: Accessing NPM web interface (http://192.168.40.25:81)
# Default: admin@example.com / changeme (MUST CHANGE ON FIRST LOGIN)
# Note: These are set via web UI, not environment variables
# Documented here for reference only
# NPM_ADMIN_EMAIL=${ADMIN_EMAIL}
# NPM_ADMIN_PASSWORD=REPLACE_WITH_STRONG_PASSWORD_32_CHARS

# Internal MySQL database password (managed by NPM container)
# Automatically generated, no manual configuration needed
# NPM_MYSQL_ROOT_PASSWORD=REPLACE_WITH_STRONG_PASSWORD_32_CHARS

# ========================================
# MONITORING STACK (LXC 200, IP: 192.168.40.30)
# ========================================

# Grafana admin password
# Used for: Accessing Grafana dashboards (http://192.168.40.30:3000)
# Default username: admin
# Rotation: Every 3 months
# Last rotated: 2025-10-01
# Generate: openssl rand -base64 32
GRAFANA_ADMIN_PASSWORD=REPLACE_WITH_STRONG_PASSWORD_32_CHARS

# Prometheus retention period
# How long to keep metrics data (default: 15d)
PROMETHEUS_RETENTION=30d

# AlertManager Slack webhook (for alert notifications)
# Create webhook: https://api.slack.com/messaging/webhooks
# Format: https://hooks.slack.com/services/T00000000/B00000000/XXXXXXXXXXXXXXXXXXXX
ALERTMANAGER_SLACK_WEBHOOK=https://hooks.slack.com/services/YOUR/WEBHOOK/HERE

# AlertManager email configuration (for critical alerts)
ALERTMANAGER_EMAIL=${ADMIN_EMAIL}
ALERTMANAGER_SMTP_HOST=smtp.gmail.com
ALERTMANAGER_SMTP_PORT=587
ALERTMANAGER_SMTP_USERNAME=homelab-alerts@gmail.com
# App-specific password (not Gmail password):
# Generate: https://myaccount.google.com/apppasswords
ALERTMANAGER_SMTP_PASSWORD=REPLACE_WITH_GMAIL_APP_SPECIFIC_PASSWORD

# ========================================
# TRUENAS (IP: 192.168.40.5)
# ========================================

# TrueNAS API key (for monitoring exporter)
# Create: TrueNAS UI > Settings > API Keys > Add
# Used for: Prometheus exporter to scrape TrueNAS metrics
# Rotation: Every 6 months
# Last rotated: 2025-08-01
TRUENAS_API_KEY=REPLACE_WITH_API_KEY_FROM_TRUENAS_WEB_UI

# TrueNAS admin password (for web UI access)
# Used for: Manual administration tasks
# Note: Not used in automation, documented for reference
# TRUENAS_ADMIN_PASSWORD=REPLACE_WITH_STRONG_PASSWORD_32_CHARS

# ========================================
# PROXMOX BACKUP SERVER (IP: 192.168.40.15)
# ========================================

# PBS API token (for automated backup verification)
# Create: PBS UI > Administration > API Tokens > Add
# Format: USER@pbs!TOKEN_NAME=UUID
# Used for: Verification script to check backup job status
# Rotation: Every 6 months
# Last rotated: 2025-10-01
PBS_API_TOKEN_ID=root@pam!homelab-verify
PBS_API_TOKEN_SECRET=REPLACE_WITH_TOKEN_FROM_PBS_WEB_UI

# ========================================
# CLOUDFLARE (External DNS & SSL)
# ========================================

# Cloudflare API token (for DNS challenge and zone management)
# Create: https://dash.cloudflare.com/profile/api-tokens
# Permissions required:
# - Zone > DNS > Edit
# - Zone > Zone > Read
# Zone Resources: Include > Specific Zone > yourdomain.com
# Used for: Let's Encrypt DNS-01 challenge, automated DNS updates
# Rotation: Every 6 months
# Last rotated: 2025-09-15
CLOUDFLARE_API_TOKEN=REPLACE_WITH_TOKEN_FROM_CLOUDFLARE_DASHBOARD

# Cloudflare Zone ID (for your domain)
# Find: Cloudflare Dashboard > Select Domain > Overview (right sidebar)
# Format: 32-character hex string
CLOUDFLARE_ZONE_ID=REPLACE_WITH_YOUR_32_CHAR_ZONE_ID

# Cloudflare email (account email)
CLOUDFLARE_EMAIL=your-email@example.com

# ========================================
# VPN CONFIGURATION (WireGuard)
# ========================================

# WireGuard server private key
# Generate: wg genkey
# Used for: WireGuard VPN server configuration
# Rotation: Every 12 months (requires client config update)
# Last rotated: 2025-06-01
WIREGUARD_PRIVATE_KEY=REPLACE_WITH_OUTPUT_FROM_WG_GENKEY

# WireGuard peer public keys (one per client)
# Generate on client: wg genkey | tee privatekey | wg pubkey > publickey
# WIREGUARD_PEER1_PUBLIC_KEY=REPLACE_WITH_CLIENT_PUBLIC_KEY
# WIREGUARD_PEER2_PUBLIC_KEY=REPLACE_WITH_CLIENT_PUBLIC_KEY

# ========================================
# OPTIONAL: AWS CREDENTIALS (for S3 backups)
# ========================================

# AWS access key for S3 backup uploads
# Create: AWS Console > IAM > Users > Security Credentials > Create Access Key
# Permissions: s3:PutObject, s3:GetObject on backup bucket
# Used for: Off-site backup uploads to S3/Glacier
# Rotation: Every 6 months
# Last rotated: Never (not currently used)
# AWS_ACCESS_KEY_ID=REPLACE_WITH_AWS_ACCESS_KEY_ID
# AWS_SECRET_ACCESS_KEY=REPLACE_WITH_AWS_SECRET_ACCESS_KEY
# AWS_DEFAULT_REGION=us-west-2
# AWS_BACKUP_BUCKET=homelab-backups-encrypted

# ========================================
# OPTIONAL: GITHUB (for Wiki.js git sync)
# ========================================

# GitHub personal access token (for automated wiki backups)
# Create: GitHub > Settings > Developer Settings > Personal Access Tokens
# Permissions: repo (full control of private repositories)
# Used for: Wiki.js git sync (auto-push every page edit)
# Rotation: Every 12 months
# Last rotated: Never (not currently used)
# GITHUB_TOKEN=ghp_REPLACE_WITH_GITHUB_PERSONAL_ACCESS_TOKEN
# GITHUB_REPO_URL=https://github.com/username/wiki-backup.git

# ========================================
# CREDENTIAL ROTATION LOG
# ========================================
# Track when credentials were last changed to ensure
# compliance with quarterly rotation schedule.
#
# CRITICAL (Rotate every 3 months):
# ----------------------------------
# POSTGRES_SUPERUSER_PASSWORD: Last changed 2025-11-01 ’ Next: 2026-02-01
# WIKIJS_DB_PASSWORD: Last changed 2025-11-01 ’ Next: 2026-02-01
# HOMEASSISTANT_DB_PASSWORD: Last changed 2025-10-15 ’ Next: 2026-01-15
# IMMICH_DB_PASSWORD: Last changed 2025-10-15 ’ Next: 2026-01-15
# GRAFANA_ADMIN_PASSWORD: Last changed 2025-10-01 ’ Next: 2026-01-01
# MQTT_PASSWORD: Last changed 2025-10-15 ’ Next: 2026-01-15
#
# MEDIUM (Rotate every 6 months):
# --------------------------------
# WIKIJS_SESSION_SECRET: Last changed 2025-11-01 ’ Next: 2026-05-01
# IMMICH_TYPESENSE_API_KEY: Last changed 2025-09-01 ’ Next: 2026-03-01
# TRUENAS_API_KEY: Last changed 2025-08-01 ’ Next: 2026-02-01 (OVERDUE)
# PBS_API_TOKEN: Last changed 2025-10-01 ’ Next: 2026-04-01
# CLOUDFLARE_API_TOKEN: Last changed 2025-09-15 ’ Next: 2026-03-15
#
# LOW (Rotate every 12 months):
# ------------------------------
# WIREGUARD_PRIVATE_KEY: Last changed 2025-06-01 ’ Next: 2026-06-01
# AWS credentials: Never (not in use)
# GitHub token: Never (not in use)
#
# NEXT ROTATION DUE: 2026-01-01 (GRAFANA_ADMIN_PASSWORD)
#
# ========================================
# CREDENTIAL STORAGE BEST PRACTICES
# ========================================
#
# 1. Password Manager (Recommended):
#    - Store this entire .env file in Bitwarden/1Password as secure note
#    - Enable 2FA on password manager account
#    - Create emergency access for disaster recovery
#
# 2. Encrypted Backup:
#    - Encrypt .env file: gpg -c .env (creates .env.gpg)
#    - Store encrypted file in git repo or cloud backup
#    - Decryption: gpg -d .env.gpg > .env
#    - Delete unencrypted .env when not actively using
#
# 3. Hardware Security Key (Advanced):
#    - Store encryption keys on YubiKey
#    - Decrypt .env only when needed for deployment
#    - Re-encrypt immediately after use
#
# 4. Secrets Management (Production Alternative):
#    - HashiCorp Vault (self-hosted secrets management)
#    - AWS Secrets Manager (cloud-based)
#    - Kubernetes Secrets (if using k8s)
#    - Docker Secrets (if using Swarm mode)
#
# ========================================
# EMERGENCY RECOVERY PROCEDURE
# ========================================
# If .env file is lost and services are down:
#
# 1. Stop all containers: cd /opt && find . -name docker-compose.yml -exec docker-compose -f {} down \;
# 2. Recover from password manager backup
# 3. Recreate .env file: nano .env (paste from password manager)
# 4. Set permissions: chmod 600 .env
# 5. Restart services: docker-compose up -d (in each service directory)
# 6. Verify connectivity: Test Wiki.js, Home Assistant, Immich logins
# 7. Update rotation log with any changed passwords
#
# If passwords are completely lost:
# 1. Database passwords: Reset via PostgreSQL superuser
# 2. Service passwords: Factory reset container, reconfigure
# 3. API tokens: Regenerate in respective web UIs
# 4. Update .env with new credentials
# 5. Document new rotation dates
#
# ========================================
