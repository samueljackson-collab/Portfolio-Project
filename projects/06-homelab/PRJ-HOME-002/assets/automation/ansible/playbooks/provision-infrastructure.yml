---
# Ansible Playbook: Provision Proxmox Infrastructure
# Initializes Proxmox nodes and prepares for cluster setup
# Version: 1.0

- name: Provision Proxmox Infrastructure
  hosts: proxmox_nodes
  become: yes
  vars:
    ntp_servers:
      - 192.168.40.1
      - pool.ntp.org
    dns_servers:
      - 192.168.40.35
      - 192.168.1.1
  
  tasks:
    - name: Update system packages
      apt:
        update_cache: yes
        upgrade: dist
        
    - name: Install required packages
      apt:
        name:
          - vim
          - htop
          - iotop
          - net-tools
          - bridge-utils
          - vlan
        state: present
        
    - name: Configure NTP
      template:
        src: ../templates/ntp.conf.j2
        dest: /etc/systemd/timesyncd.conf
      notify: restart timesyncd
      
    - name: Configure DNS
      template:
        src: ../templates/resolv.conf.j2
        dest: /etc/resolv.conf
        
    - name: Enable IP forwarding
      sysctl:
        name: net.ipv4.ip_forward
        value: '1'
        state: present
        reload: yes
  
  handlers:
    - name: restart timesyncd
      systemd:
        name: systemd-timesyncd
        state: restarted
