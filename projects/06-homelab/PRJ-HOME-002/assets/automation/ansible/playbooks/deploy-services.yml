---
# Ansible Playbook: Deploy Core Services
# Deploys and configures core infrastructure services
# Version: 1.0

- name: Deploy Core Infrastructure Services
  hosts: service_vms
  become: yes
  
  tasks:
    - name: Update package cache
      apt:
        update_cache: yes
        
    - name: Install common packages
      apt:
        name:
          - curl
          - wget
          - git
          - vim
          - htop
        state: present

- name: Deploy Pi-hole DNS
  hosts: pihole
  become: yes
  tasks:
    - name: Install Pi-hole
      shell: curl -sSL https://install.pi-hole.net | bash /dev/stdin --unattended
      args:
        creates: /usr/local/bin/pihole

- name: Deploy Nginx Reverse Proxy
  hosts: nginx
  become: yes
  tasks:
    - name: Install Nginx
      apt:
        name: nginx
        state: present
    - name: Copy configuration
      copy:
        src: ../../services/nginx/nginx.conf
        dest: /etc/nginx/nginx.conf
      notify: restart nginx
  
  handlers:
    - name: restart nginx
      systemd:
        name: nginx
        state: restarted
