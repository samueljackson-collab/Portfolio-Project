# Rsyslog Centralized Logging Configuration
# Collects logs from all homelab infrastructure
# Version: rsyslog 8.x
# Last Updated: 2025-11-05

# Modules
module(load="imuxsock")    # Local system logging
module(load="imklog")      # Kernel logging
module(load="imudp")       # UDP syslog reception
module(load="imtcp")       # TCP syslog reception

# Enable UDP and TCP reception
input(type="imudp" port="514")
input(type="imtcp" port="514")

# Templates for organized logging
template(name="RemoteHost" type="string" 
         string="/var/log/remote/%HOSTNAME%/%PROGRAMNAME%.log")

template(name="PerHostAuth" type="string"
         string="/var/log/remote/%HOSTNAME%/auth.log")

# Rules
# Local logging
*.info;mail.none;authpriv.none;cron.none    /var/log/messages
authpriv.*                                   /var/log/secure
mail.*                                       /var/log/maillog
cron.*                                       /var/log/cron

# Remote logging (from network devices)
if $fromhost-ip != '127.0.0.1' then {
    *.* ?RemoteHost
    authpriv.* ?PerHostAuth
    stop
}

# Retention and rotation handled by logrotate
# See /etc/logrotate.d/rsyslog
